import{r as s,j as t,B as T,I as k,a as y}from"./index-Clq8qEyb.js";import{D as N,A as D}from"./Delete-CENvss-X.js";import{a as v,t as z}from"./constants-Dd5hli-r.js";import{F as M,I as O,S as P,T as i}from"./TextField-36JbiGwT.js";import{M as C}from"./MenuItem-BFHTbYhj.js";import"./List-C9zJ7A1r.js";const K=()=>{const j=sessionStorage.getItem("token"),[m,u]=s.useState(""),[c,d]=s.useState(""),[b,h]=s.useState(""),[r,o]=s.useState([""]),[p,g]=s.useState(""),[x,A]=s.useState([]),[l,S]=s.useState(""),[E,f]=s.useState("30");s.useEffect(()=>{fetch(`${v}/campaigns/all`,{headers:{Authorization:`Bearer ${j}`}}).then(e=>e.json()).then(e=>A(e)).catch(e=>console.error(e))},[]);const I=()=>{u(""),d(""),h(""),o([""]),g(""),f("30"),S("")},q=(e,a)=>{const n=[...r];n[e]=a,o(n)},F=()=>o([...r,""]),w=e=>o(r.filter((a,n)=>n!==e)),W=e=>{if(!e)I();else{const a=x.find(n=>n.id===e);a&&(S(e),u(a.name),d(a.targetAudience),h(a.emailTemplate||""),o(a.emails||[""]),f(a.interval||"30"),g(a.frequency||""))}},$=async e=>{if(e.preventDefault(),!m||!c||!r.length||!p){alert("All fields except Email Template are required.");return}const a=l?`${v}/campaigns/${l}/update`:`${v}/campaigns/create`,B=await(await fetch(a,{method:l?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`},body:JSON.stringify({name:m,targetAudience:c,emailTemplate:b,emails:r,interval:E,frequency:p})})).json();alert(B.message),l||I()};return t.jsxs(T,{sx:{width:500,mx:"auto",mt:4},children:[t.jsx("h2",{children:l?"Edit Campaign":"Create Campaign"}),t.jsxs(M,{fullWidth:!0,sx:{mb:2},children:[t.jsx(O,{children:"Select Campaign to Edit"}),t.jsxs(P,{value:l,onChange:e=>W(e.target.value),children:[t.jsx(C,{value:"",children:t.jsx("em",{children:"Create New Campaign"})}),x.length>0?x.map(e=>t.jsx(C,{value:e.id,children:e.name},e.id)):""]})]}),t.jsxs("form",{onSubmit:$,children:[t.jsx(i,{label:"Campaign Name",fullWidth:!0,value:m,onChange:e=>u(e.target.value),sx:{mb:2},required:!0}),t.jsx(i,{label:"Target Audience",fullWidth:!0,value:c,onChange:e=>d(e.target.value),sx:{mb:2},required:!0}),t.jsx(i,{label:"Email Template",fullWidth:!0,value:b,onChange:e=>h(e.target.value),sx:{mb:2}}),t.jsx(i,{id:"time-interval",select:!0,label:"Time Interval",value:E,sx:{backgroundColor:"white",width:"100%",mb:2},onChange:e=>f(e.target.value),children:z.map(e=>t.jsx(C,{value:e.value,children:e.label},e.value))}),t.jsx(i,{label:"Frequency",fullWidth:!0,value:p,onChange:e=>g(e.target.value),sx:{mb:2},required:!0}),r.map((e,a)=>t.jsxs(T,{display:"flex",alignItems:"center",sx:{mb:2},children:[t.jsx(i,{label:`Email ${a+1}`,fullWidth:!0,value:e,onChange:n=>q(a,n.target.value),sx:{flexGrow:1},required:!0}),t.jsx(k,{onClick:()=>w(a),color:"error",sx:{ml:1},children:t.jsx(N,{})})]},a)),t.jsx(y,{type:"button",variant:"outlined",onClick:F,startIcon:t.jsx(D,{}),sx:{mb:2},children:"Add Email"}),t.jsx(y,{type:"submit",variant:"contained",fullWidth:!0,children:l?"Update Campaign":"Create Campaign"})]})]})};export{K as default};
