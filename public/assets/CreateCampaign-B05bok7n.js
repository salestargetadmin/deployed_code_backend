import{r as s,b as v,j as t,B as y,w as k,I as N,a as T}from"./index-BkklOD1L.js";import{D,A as z}from"./Delete-BpmDt2JS.js";import{F as M,I as O,S as P,T as i}from"./TextField-CxaqP63m.js";import{M as C}from"./MenuItem-BRiIjGjr.js";import"./List-D_zX7YuV.js";const H=()=>{const j=sessionStorage.getItem("token"),[m,u]=s.useState(""),[c,d]=s.useState(""),[b,p]=s.useState(""),[r,o]=s.useState([""]),[h,g]=s.useState(""),[x,A]=s.useState([]),[l,S]=s.useState(""),[E,f]=s.useState("30");s.useEffect(()=>{fetch(`${v}/campaigns/all`,{headers:{Authorization:`Bearer ${j}`}}).then(e=>e.json()).then(e=>A(e)).catch(e=>console.error(e))},[]);const I=()=>{u(""),d(""),p(""),o([""]),g(""),f("30"),S("")},q=(e,a)=>{const n=[...r];n[e]=a,o(n)},F=()=>o([...r,""]),w=e=>o(r.filter((a,n)=>n!==e)),W=e=>{if(!e)I();else{const a=x.find(n=>n.id===e);a&&(S(e),u(a.name),d(a.targetAudience),p(a.emailTemplate||""),o(a.emails||[""]),f(a.interval||"30"),g(a.frequency||""))}},$=async e=>{if(e.preventDefault(),!m||!c||!r.length||!h){alert("All fields except Email Template are required.");return}const a=l?`${v}/campaigns/${l}/update`:`${v}/campaigns/create`,B=await(await fetch(a,{method:l?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`},body:JSON.stringify({name:m,targetAudience:c,emailTemplate:b,emails:r,interval:E,frequency:h})})).json();alert(B.message),l||I()};return t.jsxs(y,{sx:{width:500,mx:"auto",mt:4,p:4,backgroundColor:"secondary.main",color:"primary.main",border:"2px solid",borderColor:"primary.main"},children:[t.jsx("h2",{children:l?"Edit Campaign":"Create Campaign"}),t.jsxs(M,{fullWidth:!0,sx:{mb:2},children:[t.jsx(O,{children:"Select Campaign to Edit"}),t.jsxs(P,{value:l,onChange:e=>W(e.target.value),children:[t.jsx(C,{value:"",children:t.jsx("em",{children:"Create New Campaign"})}),x.length>0?x.map(e=>t.jsx(C,{value:e.id,children:e.name},e.id)):""]})]}),t.jsxs("form",{onSubmit:$,children:[t.jsx(i,{label:"Campaign Name",fullWidth:!0,value:m,onChange:e=>u(e.target.value),sx:{mb:2},required:!0}),t.jsx(i,{label:"Target Audience",fullWidth:!0,value:c,onChange:e=>d(e.target.value),sx:{mb:2},required:!0}),t.jsx(i,{label:"Email Template",fullWidth:!0,value:b,onChange:e=>p(e.target.value),sx:{mb:2}}),t.jsx(i,{id:"time-interval",select:!0,label:"Time Interval",value:E,sx:{width:"100%",mb:2},onChange:e=>f(e.target.value),children:k.map(e=>t.jsx(C,{value:e.value,children:e.label},e.value))}),t.jsx(i,{label:"Frequency",fullWidth:!0,value:h,onChange:e=>g(e.target.value),sx:{mb:2},required:!0}),r.map((e,a)=>t.jsxs(y,{display:"flex",alignItems:"center",sx:{mb:2},children:[t.jsx(i,{label:`Email ${a+1}`,fullWidth:!0,value:e,onChange:n=>q(a,n.target.value),sx:{flexGrow:1},required:!0}),t.jsx(N,{onClick:()=>w(a),color:"error",sx:{ml:1},children:t.jsx(D,{})})]},a)),t.jsx(T,{type:"button",variant:"outlined",onClick:F,startIcon:t.jsx(z,{}),sx:{mb:2},children:"Add Email"}),t.jsx(T,{type:"submit",variant:"contained",fullWidth:!0,children:l?"Update Campaign":"Create Campaign"})]})]})};export{H as default};
